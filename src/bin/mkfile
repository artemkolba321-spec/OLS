#!/usr/bin/env bash
# OLS command: mkfile

set -euo pipefail
IFS=$'\n\t'

# ===== Paths =====
OLS_DIR="$HOME/OLS"
LOG_FILE="$OLS_DIR/logs.log"

# ===== Logging =====
ols_log() {
    echo "$(date '+%Y-%m-%d %H:%M:%S') [OLS][mkfile] $@" >> "$LOG_FILE"
}

die() {
    echo "mkfile: $@" >&2
    ols_log "EE: $@"
    exit 1
}

# ===== Help =====
show_help() {
    cat <<'EOF'
mkfile - Create files and directories

usage:
    mkfile -f <filename> [<filename>...]    Create one or more files
    mkfile -d <dirname> [<dirname>...]      Create one or more directories
    mkfile --help                           Show this help message

description:
    A utility for quickly creating files (touch) or directories (mkdir -p).
    Files must not already exist (prevents accidental overwrites).
    Directories are created with -p (parent dirs created as needed).

options:
    -f         Create empty file(s) (fails if file already exists)
    -d         Create directory/directories (creates parents if needed)
    --help     Show this help message

examples:
    mkfile -f text.txt                 create a single file
    mkfile -f a.txt b.txt c.txt        create multiple files
    mkfile -d myproject                create a directory
    mkfile -d src/components/ui        create nested directories
EOF
}

# ===== Args =====
[[ $# -eq 0 ]] && show_help && exit 0
[[ -z "${2-}" ]] && die "Missing filename or directory name"

if [[ "$1" == "--help" ]]; then
    show_help
    exit 0
fi

# ===== Main =====
case "$1" in
    -d)
        for dir in "${@:2}"; do
            mkdir -p "$dir" || die "Failed to create directory $dir"
            ols_log "Created directory: $dir"
        done
        ;;
    -f)
        for file in "${@:2}"; do
            [[ -e "$file" ]] && die "File already exists: $file"
            touch "$file" || die "Failed to create file $file"
            ols_log "Created file: $file"
        done

        ;;
    *)
        die "Invalid argument: $1"
        ;;
esac

ols_log "exec: $@"