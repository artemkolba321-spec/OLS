#!/usr/bin/env bash
# OLS command: mkfile

set -euo pipefail
IFS=$'\n\t'

source "$HOME/OLS/lib/env.sh"

# ===== Help =====
show_help() {
    cat <<'EOF'
mkfile - Create files and directories

usage:
    mkfile -f <filename> [<filename>...]    Create one or more files
    mkfile -d <dirname> [<dirname>...]      Create one or more directories
    mkfile --help                           Show this help message

description:
    A utility for quickly creating files (touch) or directories (mkdir -p).
    Files must not already exist (prevents accidental overwrites).
    Directories are created with -p (parent dirs created as needed).

options:
    -f         Create empty file(s) (fails if file already exists)
    -d         Create directory/directories (creates parents if needed)
    --help     Show this help message

examples:
    mkfile -f text.txt                 create a single file
    mkfile -f a.txt b.txt c.txt        create multiple files
    mkfile -d myproject                create a directory
    mkfile -d src/components/ui        create nested directories
EOF
}

# ===== Args =====
[[ $# -eq 0 ]] && show_help && exit 0
[[ -z "${2-}" ]] && warn "Missing filename or directory name" && exit 1

if [[ "$1" == "--help" ]]; then
    show_help
    exit 0
fi

# ===== Main =====
case "$1" in
    -d)
        for dir in "${@:2}"; do
            mkdir -p "$dir" || ee "Failed to create directory $dir"
            info "Created directory: $dir"
        done
        ;;
    -f)
        for file in "${@:2}"; do
            [[ -e "$file" ]] && ee "File already exists: $file"
            touch "$file" || ee "Failed to create file $file"
            info "Created file: $file"
        done

        ;;
    *)
        ee "Invalid argument: $1"
        ;;
esac

info "exec: $@"