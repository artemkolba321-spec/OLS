#!/usr/bin/env bash
# OLS command: open (Linux-only)

set -euo pipefail
IFS=$'\n\t'

source "$HOME/OLS/lib/env.sh"


# ===== Helpers =====
show_help() {
    cat <<'EOF'
open â€” open file, directory or URL

usage:
    open [OPTION]... TARGET

options:
    -c          create TARGET if it does not exist
    --help      show this help

examples:
    open notes.txt
    open my\ folder
    open https://example.com
    open -c newfile.txt
EOF
}
# ===== Requirements =====
command -v xdg-open >/dev/null 2>&1 \
    || die "xdg-open not found (required)"

# ===== Main =====
info "exec: $@"

[[ $# -eq 0 ]] && show_help && exit 1

case "$1" in
    --help)
        show_help
        exit 0
        ;;
    -c)
        [[ $# -lt 2 ]] && warn "missing target for -c"
        TARGET="$2"

        if [[ -e "$TARGET" ]]; then
            info "target already exists: $TARGET"
            echo "target already exists: $TARGET"
        else
            if [[ "$TARGET" == */ ]]; then
                mkdir -p "$TARGET"
                info "created directory: $TARGET"
            else
                touch "$TARGET"
                info "created file: $TARGET"
            fi
        fi

        xdg-open "$TARGET"
        info "opened: $TARGET"
        ;;
    *)
        TARGET="$1"
        xdg-open "$TARGET"
        info "opened: $TARGET"
        ;;
esac
