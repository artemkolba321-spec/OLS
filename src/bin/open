#!/usr/bin/env bash
# OLS command: open (Linux-only)

set -euo pipefail
IFS=$'\n\t'

# ===== Paths =====
OLS_DIR="$HOME/OLS"
LOG_FILE="$OLS_DIR/logs.log"

# ===== Logging =====
ols_log() {
    echo "$(date '+%Y-%m-%d %H:%M:%S') [OLS][open] $*" >> "$LOG_FILE"
}

# ===== Helpers =====
show_help() {
    cat <<'EOF'
open â€” open file, directory or URL

usage:
    open [OPTION]... TARGET

options:
    -c          create TARGET if it does not exist
    --help      show this help

examples:
    open notes.txt
    open my\ folder
    open https://example.com
    open -c newfile.txt
EOF
}

die() {
    echo "open: $*" >&2
    ols_log "ERROR: $*"
    exit 1
}

# ===== Requirements =====
command -v xdg-open >/dev/null 2>&1 \
    || die "xdg-open not found (required)"

# ===== Main =====
ols_log "exec: $*"

[[ $# -eq 0 ]] && show_help && exit 1

case "$1" in
    --help)
        show_help
        exit 0
        ;;
    -c)
        [[ $# -lt 2 ]] && die "missing target for -c"
        TARGET="$2"

        if [[ -e "$TARGET" ]]; then
            ols_log "target already exists: $TARGET"
            echo "target already exists: $TARGET"
        else
            if [[ "$TARGET" == */ ]]; then
                mkdir -p "$TARGET"
                ols_log "created directory: $TARGET"
            else
                touch "$TARGET"
                ols_log "created file: $TARGET"
            fi
        fi

        xdg-open "$TARGET"
        ols_log "opened: $TARGET"
        ;;
    *)
        TARGET="$1"
        xdg-open "$TARGET"
        ols_log "opened: $TARGET"
        ;;
esac
