#!/usr/bin/env bash
# OLS command: gx

set -euo pipefail
IFS=$'\n\t'

source "$HOME/OLS/lib/env.sh"

# ===== Help =====
if [[ $# -eq 0 || "$1" == "--help" ]]; then
    cat <<EOF
gx - Git exec (clone wrapper)

usage:
    gx <user>/<repo>       (GitHub username/repo)
    gx <HTTPS>             (https://github.com/user/repo.git)
    gx <SSH>               (git@github.com:user/repo.git)

description:
    Clones a GitHub repository. DOES NOT change directory.
EOF
    exit 0
fi

command -v git >/dev/null 2>&1 || die "Git not found"

# ===== Main =====
repo="$1"

# Determine URL and directory name
if [[ "$repo" =~ ^https://github.com/ ]]; then
    url="$repo"
    dir="$(basename "$repo" .git)"
elif [[ "$repo" =~ ^git@github.com: ]]; then
    url="$repo"
    dir="$(basename "$repo" .git)"
else
    url="https://github.com/$repo.git"
    dir="$(basename "$repo")"
fi

# If directory exists, skip cloning
if [[ -d "$dir" ]]; then
    echo "gx: directory '$dir' already exists, skipping clone"
    warn "Skip clone: $dir exists"
    exit 0
fi

# Clone repository
git clone "$url" "$dir" || ee "failed to clone $url"
echo "gx: cloned repository '$dir'"
info "Cloned repository $dir"
